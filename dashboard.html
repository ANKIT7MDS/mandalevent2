<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° (‡§´‡§ø‡§ï‡•ç‡§∏‡•ç‡§°)</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { background: #fff9f3; color: #222; font-family: 'Noto Sans Devanagari', Arial, sans-serif; margin: 0; padding: 0; }
    .container { max-width: 1200px; margin: 24px auto; background: #fff6ea; border-radius: 14px; box-shadow: 0 2px 16px #ff980020; padding: 18px 10px 18px 10px; }
    h1 { color: #e65100; text-align: center; margin-bottom: 12px; font-size: 2.1rem; }
    .top-bar { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: space-between; margin-bottom: 10px; }
    .top-bar .left, .top-bar .right { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    .top-bar select, .top-bar button, .top-bar input[type="text"] { font-size: 1rem; padding: 5px 9px; border-radius: 5px; border: 1.2px solid #ffa726a9; background: #fffaf5; color: #442300; }
    .top-bar button, .tab-btn, input[type="submit"] { background: #ff9800; color: #fff; font-weight: 600; border: none; cursor: pointer; padding: 7px 14px; border-radius: 6px; margin: 0 0 0 0; transition: background 0.2s; }
    .top-bar button:hover, .tab-btn.active, .tab-btn:hover, input[type="submit"]:hover { background: #e65100; }
    .pending-mandals { color: #e53935; font-size: 0.98rem; margin-left: 18px; }
    .tabs { display: flex; gap: 4px; margin: 10px 0 8px 0; justify-content: center; }
    .tab-btn { padding: 7px 20px; border-radius: 8px 8px 0 0; border-bottom: 2px solid transparent; background: #ffe0b2; color: #8d4700; font-weight: 600; font-size: 1.02rem; }
    .tab-btn.active { background: #ff9800; color: #fff; border-bottom: 2px solid #ff9800; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 1.2rem; background: #fff; box-shadow: 0 1px 8px #ffa72611; font-size: 0.99rem; }
    th, td { border: 1px solid #ffa72655; padding: 6px 7px; text-align: left; }
    th { background: #ffb74d; color: #442300; font-weight: bold; }
    tr:nth-child(even) { background: #fff3e0; }
    .action-btn { padding: 4px 10px; border-radius: 6px; font-size: 1.11rem; margin: 0 1px; background: #ff9800; color: #fff; border: none; cursor: pointer; transition: background 0.18s; min-width: 34px; }
    .action-btn.delete { background: #e53935; }
    .action-btn.delete:hover { background: #b71c1c; }
    .action-btn:hover { background: #e65100; }
    .report-photos-grid { display: grid; grid-template-columns: repeat(3, 74px); grid-auto-rows: 74px; gap: 6px; max-width: 200px; }
    .report-photos-grid img { width: 72px; height: 72px; object-fit: cover; border-radius: 6px; border: 1.5px solid #ff9800; cursor: zoom-in; transition: box-shadow 0.18s; background: #fff7e0; }
    #imgZoomModal { display: none; position: fixed; z-index: 2000; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.82); align-items: center; justify-content: center; }
    #imgZoomModal img { max-width: 95vw; max-height: 93vh; border-radius: 14px; border: 4px solid #fff; box-shadow: 0 0 12px #ff980099; background: #fff; }
    @media (max-width: 650px) {
      .container { max-width: 99vw; padding: 4vw 1vw 4vw 1vw;}
      .top-bar { flex-direction: column; align-items: stretch; gap: 7px;}
      .tabs { flex-direction: column; gap: 1px;}
      table, th, td { font-size: 0.94rem; }
      .report-photos-grid { grid-template-columns: repeat(3, 48px); grid-auto-rows: 48px; max-width: 130px; }
      .report-photos-grid img { width: 46px; height: 46px; }
    }
  </style>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</h1>
    <div class="top-bar">
      <div class="left">
        <label for="filterEvent">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ:</label>
        <select id="filterEvent"><option value="">‡§∏‡§≠‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ</option></select>
        <div id="eventActions" style="display: none; gap: 4px;">
            <button class="action-btn" id="editEventBtn" title="‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¨‡§¶‡§≤‡•á‡§Ç" style="font-size:1.1em;padding:2px 8px;">‚úèÔ∏è</button>
            <button class="action-btn delete" id="deleteEventBtn" title="‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§π‡§ü‡§æ‡§è‡§Ç" style="font-size:1.1em;padding:2px 8px;">‚ùå</button>
        </div>
        <label for="filterMandal">‡§Æ‡§Ç‡§°‡§≤:</label>
        <select id="filterMandal"><option value="">‡§∏‡§≠‡•Ä ‡§Æ‡§Ç‡§°‡§≤</option></select>
        <span id="pendingMandals" class="pending-mandals"></span>
      </div>
      <div class="right">
        <select id="exportDropdown" style="min-width:170px">
          <option value="">‡§°‡•á‡§ü‡§æ ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü...</option>
          <optgroup label="‡§∏‡§Ç‡§Ø‡•Å‡§ï‡•ç‡§§ (Combined)">
            <option value="combined-excel">‡§∏‡§Ç‡§Ø‡•Å‡§ï‡•ç‡§§ Excel</option>
            <option value="combined-csv">‡§∏‡§Ç‡§Ø‡•Å‡§ï‡•ç‡§§ CSV</option>
            <option value="combined-pdf">‡§∏‡§Ç‡§Ø‡•Å‡§ï‡•ç‡§§ PDF</option>
            <option value="combined-jpg">‡§∏‡§Ç‡§Ø‡•Å‡§ï‡•ç‡§§ JPG</option>
          </optgroup>
          <optgroup label="‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ">
            <option value="events-excel">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ Excel</option>
            <option value="events-csv">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ CSV</option>
            <option value="events-pdf">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ PDF</option>
            <option value="events-jpg">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ JPG</option>
          </optgroup>
          <optgroup label="‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï">
            <option value="coordinators-excel">‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï Excel</option>
            <option value="coordinators-csv">‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï CSV</option>
            <option value="coordinators-pdf">‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï PDF</option>
            <option value="coordinators-jpg">‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï JPG</option>
          </optgroup>
          <optgroup label="‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü">
            <option value="reports-excel">‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü Excel</option>
            <option value="reports-csv">‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü CSV</option>
            <option value="reports-pdf">‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü PDF</option>
            <option value="reports-jpg">‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü JPG</option>
          </optgroup>
        </select>
        <button onclick="handleExport()">‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°</button>
        <input type="text" id="newEventName" placeholder="‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§®‡§æ‡§Æ" style="width:120px;">
        <button onclick="addEventName()">‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
      </div>
    </div>
    <div class="tabs">
      <button class="tab-btn" id="eventTabBtn" onclick="switchTab('eventsTab')">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§∏‡•Ç‡§ö‡•Ä</button>
      <button class="tab-btn" id="coordinatorTabBtn" onclick="switchTab('coordinatorsTab')">‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï ‡§∏‡•Ç‡§ö‡•Ä</button>
      <button class="tab-btn active" id="reportTabBtn" onclick="switchTab('reportsTab')">‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡•Ç‡§ö‡•Ä</button>
    </div>
    <div class="tab-content" id="eventsTab">
      <table>
        <thead><tr><th>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ</th><th>‡§Æ‡§Ç‡§°‡§≤</th><th>‡§§‡§æ‡§∞‡•Ä‡§ñ</th><th>‡§∏‡§Æ‡§Ø</th><th>‡§∏‡•ç‡§•‡§æ‡§®</th><th>‡§è‡§ï‡•ç‡§∂‡§®</th></tr></thead>
        <tbody id="eventList"></tbody>
      </table>
      <div id="eventPagination"></div>
    </div>
    <div class="tab-content" id="coordinatorsTab">
      <table>
        <thead><tr><th>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ</th><th>‡§Æ‡§Ç‡§°‡§≤</th><th>‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï</th><th>‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤</th><th>‡§∏‡§π-‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï 1</th><th>‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ 1</th><th>‡§∏‡§π-‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï 2</th><th>‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ 2</th><th>‡§è‡§ï‡•ç‡§∂‡§®</th></tr></thead>
        <tbody id="coordinatorList"></tbody>
      </table>
      <div id="coordPagination"></div>
    </div>
    <div class="tab-content active" id="reportsTab">
      <table>
        <thead><tr><th>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ</th><th>‡§Æ‡§Ç‡§°‡§≤</th><th>‡§∏‡•ç‡§•‡§æ‡§®</th><th>‡§§‡§æ‡§∞‡•Ä‡§ñ</th><th>‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡§ø</th><th>‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§Ö‡§§‡§ø‡§•‡§ø</th><th>‡§µ‡§ø‡§µ‡§∞‡§£</th><th>‡§´‡•ã‡§ü‡•ã</th><th>‡§è‡§ï‡•ç‡§∂‡§®</th></tr></thead>
        <tbody id="reportList"></tbody>
      </table>
      <div id="reportPagination"></div>
    </div>
  </div>
  <div id="imgZoomModal"><img id="imgZoomModalImg" src=""></div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getFirestore, collection, getDocs, doc, deleteDoc, addDoc, updateDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
    const firebaseConfig = {
      apiKey: "AIzaSyCI1EL8iFVJnOWbd58Bq5JrJg_IgZuCvA0",
      authDomain: "mandaleventall.firebaseapp.com",
      projectId: "mandaleventall",
      storageBucket: "mandaleventall.firebasestorage.app",
      messagingSenderId: "900190130114",
      appId: "1:900190130114:web:bc7d9e2283b3ac57bc505b",
      measurementId: "G-2BBZZNRS88"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const mandals = ["‡§≠‡•á‡§Ç‡§∏‡•ã‡§¶‡§æ", "‡§≠‡§æ‡§®‡§™‡•Å‡§∞‡§æ", "‡§ó‡§∞‡•ã‡§†", "‡§Æ‡•á‡§≤‡§ñ‡•á‡§°‡§æ", "‡§ñ‡§°‡§º‡§æ‡§µ‡§¶‡§æ", "‡§∂‡§æ‡§Æ‡§ó‡•ù", "‡§∏‡•Å‡§µ‡§æ‡§∏‡§∞‡§æ", "‡§¨‡§∏‡§æ‡§à", "‡§∏‡•Ä‡§§‡§æ‡§Æ‡§ä", "‡§ï‡•ç‡§Ø‡§æ‡§Æ‡§™‡•Å‡§∞", "‡§∏‡•Ä‡§§‡§æ‡§Æ‡§ä ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£", "‡§ó‡•Å‡§∞‡•ç‡§ú‡§∞ ‡§¨‡§∞‡§°‡§ø‡§Ø‡§æ", "‡§ß‡•Å‡§Ç‡§ß‡§ß‡•ú‡§ï‡§æ", "‡§¨‡•Å‡§¢‡§æ", "‡§™‡§ø‡§™‡§≤‡§ø‡§Ø‡§æ ‡§Æ‡§Ç‡§°‡•Ä", "‡§Æ‡§≤‡•ç‡§π‡§æ‡§∞‡§ó‡•ù", "‡§¶‡§≤‡•ã‡§¶‡§æ", "‡§Æ‡§ó‡§∞‡§æ‡§Æ‡§æ‡§§‡§æ ‡§ú‡•Ä", "‡§Æ‡§Ç‡§¶‡§∏‡•å‡§∞ ‡§ó‡•ç‡§∞‡§æ‡§Æ‡•Ä‡§£", "‡§Æ‡§Ç‡§¶‡§∏‡•å‡§∞ ‡§â‡§§‡•ç‡§§‡§∞", "‡§Æ‡§Ç‡§¶‡§∏‡•å‡§∞ ‡§¶‡§ï‡•ç‡§∑‡§ø‡§£"];
    const eventNameMap = {};
    let eventPage = 1, coordPage = 1, reportPage = 1;
    const PAGE_SIZE = 21;
    const TELEGRAM_BOT_TOKEN = "8064306737:AAFvXvc3vIT1kyccGiPbpYGCAr9dgKJcRzw";
    const TELEGRAM_CHAT_ID = "733804072";
    async function sendTelegramAlert(message) {
      try {
        await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
          method: "POST", headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: message })
        });
      } catch (err) { console.error("‡§ü‡•á‡§≤‡•Ä‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§Ö‡§≤‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§≠‡•á‡§ú‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§æ:", err); }
    }
    let lastPendingKey = "";
    async function loadEventNames({ preserveSelection = true } = {}) {
      const filterEvent = document.getElementById('filterEvent');
      const previousValue = preserveSelection ? filterEvent.value : "";
      filterEvent.innerHTML = `<option value="">‡§∏‡§≠‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ</option>`;
      const snap = await getDocs(collection(db, "eventNames"));
      for (const docSnap of snap.docs) {
        const data = docSnap.data();
        eventNameMap[docSnap.id] = data.name || 'Unknown';
        const option = document.createElement('option');
        option.value = docSnap.id;
        option.textContent = data.name;
        filterEvent.appendChild(option);
      }
      if (preserveSelection) filterEvent.value = previousValue;
    }
    window.addEventName = async function() {
      const newEventName = document.getElementById('newEventName').value.trim();
      if (!newEventName) return alert('‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡§ø‡§è!');
      await addDoc(collection(db, "eventNames"), { name: newEventName });
      document.getElementById('newEventName').value = '';
      await loadEventNames({ preserveSelection: true });
      await loadListsOnly();
    };
    window.editEventNamePrompt = async function(eventNameId) {
      const current = eventNameMap[eventNameId] || '';
      const updated = prompt("‡§®‡§Ø‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç:", current);
      if (updated && updated.trim() && updated !== current) {
        await updateDoc(doc(db, "eventNames", eventNameId), { name: updated.trim() });
        await loadEventNames({ preserveSelection: true });
        await loadListsOnly();
      }
    };
    window.deleteEventName = async function(eventNameId) {
      if (confirm("‡§á‡§∏ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§®‡§æ‡§Æ ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡•á ‡§∏‡•á ‡§∏‡§Æ‡•ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§∏‡§≠‡•Ä ‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï ‡§î‡§∞ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§≠‡•Ä ‡§π‡§ü ‡§ú‡§æ‡§Ø‡•á‡§Ç‡§ó‡•á!\n‡§™‡§ï‡•ç‡§ï‡§æ?")) {
        await deleteDoc(doc(db, "eventNames", eventNameId));
        document.getElementById('filterEvent').value = ''; 
        document.getElementById('eventActions').style.display = 'none';
        await loadEventNames({ preserveSelection: false });
        await loadListsOnly();
      }
    };
    const filterMandal = document.getElementById('filterMandal');
    mandals.forEach(m => {
      const opt = document.createElement('option');
      opt.value = m;
      opt.textContent = m;
      filterMandal.appendChild(opt);
    });
    document.getElementById('filterEvent').addEventListener('change', function(){
      const selectedEventId = this.value;
      const eventActionsDiv = document.getElementById('eventActions');
      if (selectedEventId) {
        eventActionsDiv.style.display = 'flex';
        document.getElementById('editEventBtn').onclick = () => editEventNamePrompt(selectedEventId);
        document.getElementById('deleteEventBtn').onclick = () => deleteEventName(selectedEventId);
      } else {
        eventActionsDiv.style.display = 'none';
      }
      eventPage=1;coordPage=1;reportPage=1;loadListsOnly();
    });
    document.getElementById('filterMandal').addEventListener('change', function(){eventPage=1;coordPage=1;reportPage=1;loadListsOnly();});
    function switchTab(tabId) {
      ['eventsTab','coordinatorsTab','reportsTab'].forEach(id => document.getElementById(id).classList.remove('active'));
      ['eventTabBtn','coordinatorTabBtn','reportTabBtn'].forEach(id=>document.getElementById(id).classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      if(tabId==='eventsTab') document.getElementById('eventTabBtn').classList.add('active');
      else if(tabId==='coordinatorsTab') document.getElementById('coordinatorTabBtn').classList.add('active');
      else document.getElementById('reportTabBtn').classList.add('active');
    }
    window.switchTab = switchTab;
    async function loadEvents() {
      const eventList = document.getElementById('eventList');
      eventList.innerHTML = '';
      document.getElementById('eventPagination').innerHTML = '';
      const filterEventId = document.getElementById('filterEvent').value;
      const filterMandalVal = document.getElementById('filterMandal').value;
      const events = await getDocs(collection(db, "events"));
      let filtered = [];
      for (const docSnap of events.docs) {
        const event = docSnap.data();
        if (filterEventId && event.eventNameId !== filterEventId) continue;
        if (filterMandalVal && event.mandal !== filterMandalVal) continue;
        filtered.push({id: docSnap.id, ...event});
      }
      const totalPages = Math.max(1, Math.ceil(filtered.length / PAGE_SIZE));
      if (eventPage > totalPages) eventPage = totalPages;
      const pageEvents = filtered.slice((eventPage-1)*PAGE_SIZE, eventPage*PAGE_SIZE);
      for (const event of pageEvents) {
        let eventName = eventNameMap[event.eventNameId] || 'Unknown';
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${eventName}</td><td>${event.mandal || '-'}</td><td>${event.date || '-'}</td><td>${event.time || '-'}</td><td>${event.location || '-'}</td>
          <td><button class="action-btn" onclick="editEvent('${event.id}')">‚úèÔ∏è</button><button class="action-btn delete" onclick="deleteEvent('${event.id}')">üóëÔ∏è</button></td>`;
        eventList.appendChild(row);
      }
      document.getElementById('eventPagination').innerHTML = `<div class="pagination-controls" style="text-align:center"><button onclick="changeEventPage(-1)" ${eventPage==1?'disabled':''}>‡§™‡§ø‡§õ‡§≤‡§æ</button> ${eventPage}/${totalPages} <button onclick="changeEventPage(1)" ${eventPage==totalPages?'disabled':''}>‡§Ö‡§ó‡§≤‡§æ</button></div>`;
    }
    window.changeEventPage = function(diff) { eventPage += diff; loadEvents(); };
    window.editEvent = async function(id) {
      const docSnap = await getDoc(doc(db, "events", id));
      if (!docSnap.exists()) return alert("‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ!");
      const event = docSnap.data();
      const mandal = prompt("‡§Æ‡§Ç‡§°‡§≤:", event.mandal || ""); const date = prompt("‡§§‡§æ‡§∞‡•Ä‡§ñ:", event.date || ""); const time = prompt("‡§∏‡§Æ‡§Ø:", event.time || ""); const location = prompt("‡§∏‡•ç‡§•‡§æ‡§®:", event.location || "");
      if (mandal !== null) { await updateDoc(doc(db, "events", id), { mandal, date, time, location }); await loadEvents(); }
    };
    window.deleteEvent = async function(id) { if (confirm("‡§™‡§ï‡•ç‡§ï‡§æ ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§®‡§æ ‡§π‡•à?")) { await deleteDoc(doc(db, "events", id)); await loadEvents(); } };
    async function loadCoordinators() {
      const coordinatorList = document.getElementById('coordinatorList');
      coordinatorList.innerHTML = ''; document.getElementById('coordPagination').innerHTML = '';
      const filterEventId = document.getElementById('filterEvent').value; const filterMandalVal = document.getElementById('filterMandal').value;
      let filtered = [];
      const eventNames = await getDocs(collection(db, "eventNames"));
      for (const eventNameDoc of eventNames.docs) {
        const eventNameId = eventNameDoc.id;
        if (filterEventId && eventNameId !== filterEventId) continue;
        const name = eventNameDoc.data().name || '';
        const coords = await getDocs(collection(db, `eventNames/${eventNameId}/coordinators`));
        for (const docSnap of coords.docs) {
          const c = docSnap.data();
          if (filterMandalVal && c.mandal !== filterMandalVal) continue;
          filtered.push({id: docSnap.id, eventNameId,eventName: name, ...c});
        }
      }
      const totalPages = Math.max(1, Math.ceil(filtered.length / PAGE_SIZE));
      if (coordPage > totalPages) coordPage = totalPages;
      const pageCoords = filtered.slice((coordPage-1)*PAGE_SIZE, coordPage*PAGE_SIZE);
      for (const c of pageCoords) {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${c.eventName || ''}</td><td>${c.mandal || '-'}</td><td>${c.name || '-'}</td><td>${c.mobile || '-'}</td>
          <td>${c.coCoordName1 || '-'}</td><td>${c.coCoordMobile1 || '-'}</td><td>${c.coCoordName2 || '-'}</td><td>${c.coCoordMobile2 || '-'}</td>
          <td><button class="action-btn" onclick="editCoordinator('${c.eventNameId}','${c.id}')">‚úèÔ∏è</button><button class="action-btn delete" onclick="deleteCoordinator('${c.eventNameId}','${c.id}')">üóëÔ∏è</button></td>`;
        coordinatorList.appendChild(row);
      }
      document.getElementById('coordPagination').innerHTML = `<div class="pagination-controls" style="text-align:center"><button onclick="changeCoordPage(-1)" ${coordPage==1?'disabled':''}>‡§™‡§ø‡§õ‡§≤‡§æ</button> ${coordPage}/${totalPages} <button onclick="changeCoordPage(1)" ${coordPage==totalPages?'disabled':''}>‡§Ö‡§ó‡§≤‡§æ</button></div>`;
    }
    window.changeCoordPage = function(diff) { coordPage += diff; loadCoordinators(); };
    window.editCoordinator = async function(eventNameId, coordId) {
      const docSnap = await getDoc(doc(db, `eventNames/${eventNameId}/coordinators`, coordId));
      if (!docSnap.exists()) return alert("‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ!");
      const c = docSnap.data();
      const mandal = prompt("‡§Æ‡§Ç‡§°‡§≤:", c.mandal || ""); const name = prompt("‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï:", c.name || ""); const mobile = prompt("‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤:", c.mobile || ""); const coCoordName1 = prompt("‡§∏‡§π-‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï 1:", c.coCoordName1 || ""); const coCoordMobile1 = prompt("‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ 1:", c.coCoordMobile1 || ""); const coCoordName2 = prompt("‡§∏‡§π-‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï 2:", c.coCoordName2 || ""); const coCoordMobile2 = prompt("‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ 2:", c.coCoordMobile2 || "");
      if (mandal !== null) { await updateDoc(doc(db, `eventNames/${eventNameId}/coordinators`, coordId), { mandal, name, mobile, coCoordName1, coCoordMobile1, coCoordName2, coCoordMobile2 }); await loadCoordinators(); }
    };
    window.deleteCoordinator = async function(eventNameId, coordId) { if (confirm("‡§™‡§ï‡•ç‡§ï‡§æ ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§®‡§æ ‡§π‡•à?")) { await deleteDoc(doc(db, `eventNames/${eventNameId}/coordinators`, coordId)); await loadCoordinators(); } };
    async function loadReports() {
      const reportList = document.getElementById('reportList');
      reportList.innerHTML = ''; document.getElementById('reportPagination').innerHTML = '';
      const filterEventId = document.getElementById('filterEvent').value; const filterMandalVal = document.getElementById('filterMandal').value;
      let filtered = [];
      const eventNames = await getDocs(collection(db, "eventNames"));
      for (const eventNameDoc of eventNames.docs) {
        const eventNameId = eventNameDoc.id;
        if (filterEventId && eventNameId !== filterEventId) continue;
        const name = eventNameDoc.data().name || '';
        const reports = await getDocs(collection(db, `eventNames/${eventNameId}/reports`));
        for (const docSnap of reports.docs) {
          const r = docSnap.data();
          if (filterMandalVal && r.mandal !== filterMandalVal) continue;
          filtered.push({id: docSnap.id, eventNameId, name, ...r});
        }
      }
      const reportedMandals = new Set(filtered.map(r => r.mandal));
      let pendingMandals = mandals.filter(m => !reportedMandals.has(m));
      if (document.getElementById('filterMandal').value) pendingMandals = [];
      const pendingText = pendingMandals.length ? `‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç: ${pendingMandals.join(", ")}` : '‡§∏‡§≠‡•Ä ‡§Æ‡§Ç‡§°‡§≤‡•ã‡§Ç ‡§∏‡•á ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§‡•§';
      document.getElementById('pendingMandals').innerText = pendingMandals.length ? pendingText : '';
      const currentKey = pendingMandals.join("|");
      if (currentKey !== lastPendingKey) {
        lastPendingKey = currentKey;
        await sendTelegramAlert(pendingMandals.length ? `üîî ‡§∂‡•á‡§∑ (${pendingMandals.length}) ‡§Æ‡§Ç‡§°‡§≤ ‡§ú‡§ø‡§®‡§ï‡•Ä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§Ü‡§à: ${pendingMandals.join(", ")}` : "‚úÖ ‡§∏‡§≠‡•Ä ‡§Æ‡§Ç‡§°‡§≤‡•ã‡§Ç ‡§ï‡•Ä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§π‡•ã ‡§ó‡§à‡•§" );
      }
      const totalPages = Math.max(1, Math.ceil(filtered.length / PAGE_SIZE));
      if (reportPage > totalPages) reportPage = totalPages;
      const pageReports = filtered.slice((reportPage-1)*PAGE_SIZE, reportPage*PAGE_SIZE);
      for (const r of pageReports) {
        let photosHTML = "";
        if (Array.isArray(r.photos)) {
          photosHTML = `<div class="report-photos-grid">${r.photos.slice(0,6).map(url => `<img src="${url}" onclick="zoomImage(event, '${url}')">`).join('')}</div>`;
        }
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${r.name}</td><td>${r.mandal || '-'}</td><td>${r.location || '-'}</td><td>${r.date || '-'}</td>
          <td>${r.attendance || '-'}</td><td>${r.guests || '-'}</td><td>${r.details || '-'}</td><td>${photosHTML}</td>
          <td><button class="action-btn" onclick="editReport('${r.eventNameId}','${r.id}')">‚úèÔ∏è</button><button class="action-btn delete" onclick="deleteReport('${r.eventNameId}','${r.id}')">üóëÔ∏è</button></td>`;
        reportList.appendChild(row);
      }
      document.getElementById('reportPagination').innerHTML = `<div class="pagination-controls" style="text-align:center"><button onclick="changeReportPage(-1)" ${reportPage==1?'disabled':''}>‡§™‡§ø‡§õ‡§≤‡§æ</button> ${reportPage}/${totalPages} <button onclick="changeReportPage(1)" ${reportPage==totalPages?'disabled':''}>‡§Ö‡§ó‡§≤‡§æ</button></div>`;
    }
    window.changeReportPage = function(diff) { reportPage += diff; loadReports(); };
    window.editReport = async function(eventNameId, reportId) {
      const docSnap = await getDoc(doc(db, `eventNames/${eventNameId}/reports`, reportId));
      if (!docSnap.exists()) return alert("‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ!");
      const r = docSnap.data();
      const mandal = prompt("‡§Æ‡§Ç‡§°‡§≤:", r.mandal || ""); const location = prompt("‡§∏‡•ç‡§•‡§æ‡§®:", r.location || ""); const date = prompt("‡§§‡§æ‡§∞‡•Ä‡§ñ:", r.date || ""); const attendance = prompt("‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡§ø:", r.attendance || ""); const guests = prompt("‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§Ö‡§§‡§ø‡§•‡§ø:", r.guests || ""); const details = prompt("‡§µ‡§ø‡§µ‡§∞‡§£:", r.details || "");
      if (mandal !== null) { await updateDoc(doc(db, `eventNames/${eventNameId}/reports`, reportId), { mandal, location, date, attendance, guests, details }); await loadReports(); }
    };
    window.deleteReport = async function(eventNameId, reportId) { if (confirm("‡§™‡§ï‡•ç‡§ï‡§æ ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§®‡§æ ‡§π‡•à?")) { await deleteDoc(doc(db, `eventNames/${eventNameId}/reports`, reportId)); await loadReports(); } };
    window.zoomImage = function(e, url) { e.preventDefault(); document.getElementById('imgZoomModalImg').src = url; document.getElementById('imgZoomModal').style.display = 'flex'; };
    document.getElementById('imgZoomModal').onclick = function() { this.style.display = 'none'; document.getElementById('imgZoomModalImg').src = ''; };
    async function loadListsOnly() { await Promise.all([loadEvents(), loadCoordinators(), loadReports()]); }
    async function loadAll({ refreshEventNames = true } = {}) { if (refreshEventNames) await loadEventNames({ preserveSelection: true }); await loadListsOnly(); }
    loadAll({ refreshEventNames: true });
  </script>

  <script>
    // ===================================================================
    // ===== FONT DATA: NotoSansDevanagari has been embedded here ======
    // ===================================================================
    // This very long string is the actual font file data.
    // By including it here, we ensure it's always available for PDF generation.
    const NotoSansDevanagariNormal = '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gACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAgACgAAAAg/uAAZAAB//AP8A/wAJAAD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/w-';
    window.exportEvents = function(type) {
      const table = document.querySelector('#eventsTab table');
      exportTableData(table, type, "‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§∏‡•Ç‡§ö‡•Ä");
    };
    window.exportCoordinators = function(type) {
      const table = document.querySelector('#coordinatorsTab table');
      exportTableData(table, type, "‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï ‡§∏‡•Ç‡§ö‡•Ä");
    };
    window.exportReports = function(type) {
      const table = document.querySelector('#reportsTab table');
      exportTableData(table, type, "‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡•Ç‡§ö‡•Ä");
    };
    function exportTableData(table, type, title) {
      const rows = Array.from(table.querySelectorAll('tr'));
      const data = rows.map(row => Array.from(row.children).map(cell => cell.innerText));
      if (!data.length) return alert("‡§°‡•á‡§ü‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à!");
      if (type === 'csv' || type === 'excel') {
        const ws = XLSX.utils.aoa_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, title);
        if (type === 'csv') XLSX.writeFile(wb, `${title}.csv`);
        else XLSX.writeFile(wb, `${title}.xlsx`);
      }
      if (type === 'pdf') {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({orientation:'portrait', unit:'pt', format:'a4'});
        doc.addFileToVFS("NotoSansDevanagari-Regular-normal.ttf", NotoSansDevanagariNormal);
        doc.addFont("NotoSansDevanagari-Regular-normal.ttf", "NotoSansDevanagari", "normal");
        doc.setFont("NotoSansDevanagari");
        doc.setFontSize(14);
        doc.text(title, 40, 40, {lang: "hi"});
        doc.autoTable({
          startY: 60,
          head: [data[0]],
          body: data.slice(1),
          styles: { font: "NotoSansDevanagari", fontSize: 10 },
          headStyles: {fillColor:[255,152,0]},
          bodyStyles: {textColor:30}
        });
        doc.save(`${title}.pdf`);
      }
    }
    window.exportCombinedTable = function(type="excel") {
      const masterHeader = [
        "‡§°‡•á‡§ü‡§æ ‡§∏‡•ç‡§∞‡•ã‡§§", "‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§®‡§æ‡§Æ", "‡§Æ‡§Ç‡§°‡§≤", "‡§§‡§æ‡§∞‡•Ä‡§ñ", "‡§∏‡§Æ‡§Ø", "‡§∏‡•ç‡§•‡§æ‡§®",
        "‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï", "‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤", "‡§∏‡§π-‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï1", "‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤1", "‡§∏‡§π-‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï2", "‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤2",
        "‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡§ø", "‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§Ö‡§§‡§ø‡§•‡§ø", "‡§µ‡§ø‡§µ‡§∞‡§£"
      ];
      let allRows = [masterHeader];
      document.querySelectorAll("#eventList tr").forEach(tr => {
        const tds = [...tr.querySelectorAll("td")];
        if(tds.length) allRows.push([
          "‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§∏‡•Ç‡§ö‡•Ä", tds[0]?.innerText||"", tds[1]?.innerText||"", tds[2]?.innerText||"", tds[3]?.innerText||"", tds[4]?.innerText||"", "", "", "", "", "", "", "", "", ""
        ]);
      });
      document.querySelectorAll("#coordinatorList tr").forEach(tr => {
        const tds = [...tr.querySelectorAll("td")];
        if(tds.length) allRows.push([
          "‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï ‡§∏‡•Ç‡§ö‡•Ä", tds[0]?.innerText||"", tds[1]?.innerText||"", "", "", "", tds[2]?.innerText||"", tds[3]?.innerText||"", tds[4]?.innerText||"", tds[5]?.innerText||"", tds[6]?.innerText||"", tds[7]?.innerText||"", "", ""
        ]);
      });
      document.querySelectorAll("#reportList tr").forEach(tr => {
        const tds = [...tr.querySelectorAll("td")];
        if(tds.length) allRows.push([
          "‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡•Ç‡§ö‡•Ä", tds[0]?.innerText||"", tds[1]?.innerText||"", tds[3]?.innerText||"", "", tds[2]?.innerText||"", "", "", "", "", "", "", tds[4]?.innerText||"", tds[5]?.innerText||"", tds[6]?.innerText||""
        ]);
      });
      if (type==="csv" || type==="excel") {
        const ws = XLSX.utils.aoa_to_sheet(allRows);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "AllData");
        if(type==="csv") XLSX.writeFile(wb, "AllData.csv");
        else XLSX.writeFile(wb, "AllData.xlsx");
      }
      else if (type==="pdf") {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({orientation:'landscape',unit:'pt',format:'a3'});
        doc.addFileToVFS("NotoSansDevanagari-Regular-normal.ttf", NotoSansDevanagariNormal);
        doc.addFont("NotoSansDevanagari-Regular-normal.ttf", "NotoSansDevanagari", "normal");
        doc.setFont("NotoSansDevanagari");
        doc.setFontSize(14);
        doc.text("‡§Æ‡§Ç‡§°‡§≤ ‡§∏‡§Ç‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§°‡•á‡§ü‡§æ ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü", 40, 40, {lang: "hi"});
        doc.autoTable({
          startY: 60,
          head: [masterHeader],
          body: allRows.slice(1),
          styles: { font: "NotoSansDevanagari", fontSize: 10 },
          headStyles: {fillColor:[255,152,0]},
          bodyStyles: {textColor:30}
        });
        doc.save("AllData.pdf");
      }
    };
    async function exportReportsToPdfAdvanced() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation: 'portrait', unit: 'pt', format: 'a4' });
      doc.addFileToVFS("NotoSansDevanagari-Regular-normal.ttf", NotoSansDevanagariNormal);
      doc.addFont("NotoSansDevanagari-Regular-normal.ttf", "NotoSansDevanagari", "normal");
      doc.setFont("NotoSansDevanagari");
      const reportRows = document.querySelectorAll('#reportList tr');
      if (reportRows.length === 0) { return alert("‡§ï‡•ã‡§à ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ!"); }
      const imageToBase64 = async (url) => {
        try {
          const response = await fetch(url);
          const blob = await response.blob();
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.onerror = reject;
            reader.readAsDataURL(blob);
          });
        } catch (e) {
          console.error(`‡§õ‡§µ‡§ø ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∏‡§ï‡•Ä: ${url}`, e);
          const canvas = document.createElement('canvas');
          canvas.width = 100; canvas.height = 100;
          const ctx = canvas.getContext('2d');
          ctx.fillStyle = "#eee"; ctx.fillRect(0, 0, 100, 100);
          ctx.fillStyle = "#777"; ctx.font = "12px Arial";
          ctx.fillText("Error", 35, 55);
          return canvas.toDataURL();
        }
      };
      doc.setFontSize(20);
      doc.text("‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡•Ç‡§ö‡•Ä", doc.internal.pageSize.getWidth() / 2, 40, { align: 'center' });
      let yPosition = 70;
      const pageHeight = doc.internal.pageSize.getHeight();
      const margin = 40;
      for (let i = 0; i < reportRows.length; i++) {
        const row = reportRows[i];
        const cells = row.querySelectorAll('td');
        if (cells.length === 0) continue;
        const textLines = (cells[6].innerText.length / 50) + 5;
        const estimatedHeight = textLines * 15 + (cells[7].querySelectorAll('img').length > 0 ? 100 : 0);
        if (yPosition + estimatedHeight > pageHeight - margin) {
          doc.addPage();
          yPosition = 40;
        }
        if (i > 0) {
           doc.setDrawColor(200);
           doc.line(margin, yPosition, doc.internal.pageSize.getWidth() - margin, yPosition);
           yPosition += 20;
        }
        const reportData = {
          "‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ": cells[0].innerText, "‡§Æ‡§Ç‡§°‡§≤": cells[1].innerText, "‡§∏‡•ç‡§•‡§æ‡§®": cells[2].innerText, "‡§§‡§æ‡§∞‡•Ä‡§ñ": cells[3].innerText,
          "‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡§ø": cells[4].innerText, "‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§Ö‡§§‡§ø‡§•‡§ø": cells[5].innerText, "‡§µ‡§ø‡§µ‡§∞‡§£": cells[6].innerText
        };
        doc.setFontSize(14);
        doc.setFont("NotoSansDevanagari", "bold");
        doc.text(`${reportData['‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ']} - ${reportData['‡§Æ‡§Ç‡§°‡§≤']}`, margin, yPosition);
        yPosition += 25;
        doc.setFontSize(11);
        doc.setFont("NotoSansDevanagari", "normal");
        let textX = margin + 5;
        for (const [key, value] of Object.entries(reportData)) {
          if (key !== "‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ" && key !== "‡§Æ‡§Ç‡§°‡§≤" && value && value.trim() !== '-') {
            const fullText = `${key}: ${value}`;
            const splitText = doc.splitTextToSize(fullText, doc.internal.pageSize.getWidth() - margin * 2 - 10);
            doc.text(splitText, textX, yPosition);
            yPosition += (splitText.length * 12) + 8;
          }
        }
        const images = Array.from(cells[7].querySelectorAll('img'));
        if (images.length > 0) {
          yPosition += 10;
          doc.setFont("NotoSansDevanagari", "bold");
          doc.text("‡§´‡•ã‡§ü‡•ã:", margin, yPosition);
          yPosition += 15;
          doc.setFont("NotoSansDevanagari", "normal");
          const photoSize = 70; const photoGap = 8; let photoX = margin;
          const maxPhotosPerRow = Math.floor((doc.internal.pageSize.getWidth() - margin*2) / (photoSize + photoGap));
          for(let j = 0; j < images.length; j++) {
            const img = images[j];
            const base64Img = await imageToBase64(img.src);
            if (j > 0 && j % maxPhotosPerRow === 0) {
              photoX = margin;
              yPosition += photoSize + photoGap;
               if (yPosition + photoSize > pageHeight - margin) { doc.addPage(); yPosition = 40; }
            }
            doc.addImage(base64Img, 'JPEG', photoX, yPosition, photoSize, photoSize);
            photoX += photoSize + photoGap;
          }
          yPosition += photoSize + 20;
        } else { yPosition += 10; }
      }
      doc.save("‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü-‡§∏‡•Ç‡§ö‡•Ä.pdf");
    }
    window.handleExport = function() {
      const value = document.getElementById('exportDropdown').value;
      if (!value) return alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç!");
      if (value === 'reports-pdf') {
        alert("PDF ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§ï‡•Ä ‡§ú‡§æ ‡§∞‡§π‡•Ä ‡§π‡•à... ‡§á‡§∏‡§Æ‡•á‡§Ç ‡§á‡§Æ‡•á‡§ú ‡§ï‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§ï‡•Å‡§õ ‡§∏‡§Æ‡§Ø ‡§≤‡§ó ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç‡•§");
        exportReportsToPdfAdvanced().catch(err => {
          console.error("PDF ‡§¨‡§®‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø:", err);
          alert("PDF ‡§¨‡§®‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à‡•§ ‡§ï‡§Ç‡§∏‡•ã‡§≤ ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§");
        });
        return;
      }
      if (value.endsWith("-jpg")) {
        let selector = "";
        if (value.startsWith("reports-")) selector = "#reportsTab";
        else if (value.startsWith("events-")) selector = "#eventsTab";
        else if (value.startsWith("coordinators-")) selector = "#coordinatorsTab";
        else selector = ".container";
        exportSectionAsJPG(selector, "Dashboard-" + Date.now());
        return;
      }
      if (value.startsWith("combined-")) {
        const type = value.split("-")[1];
        exportCombinedTable(type);
      } else if (value.startsWith("events-")) {
        const type = value.split("-")[1];
        exportEvents(type);
      } else if (value.startsWith("coordinators-")) {
        const type = value.split("-")[1];
        exportCoordinators(type);
      } else if (value.startsWith("reports-")) {
        const type = value.split("-")[1];
        exportReports(type);
      }
    };
    function exportSectionAsJPG(selector, fileName="Dashboard") {
      const section = document.querySelector(selector);
      if(!section) return alert("‡§∏‡•á‡§ï‡•ç‡§∂‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ!");
      html2canvas(section, {backgroundColor:"#fff"}).then(canvas => {
        let link = document.createElement("a");
        link.href = canvas.toDataURL("image/jpeg", 1.0);
        link.download = fileName+".jpg";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      });
    }
  </script>
</body>
</html>
